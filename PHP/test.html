<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<div class="wrapper">
    <div class="agenda-grid-wrapper" style="display: grid;grid-template-columns: repeat(7, 1fr);grid-template-rows: repeat(96, 15px);grid-column-gap: 1%;width: 79vw;height: 100%;overflow-y: visible;overflow-x: visible;scroll-margin-top: 200px;"></div>
</div>
<script>
    let agenda_wrapper = document.getElementsByClassName('agenda-grid-wrapper')[0];
    let start_timeInverted = false;
    let row_amount = 92;
    let colom_amount = 7;

    let is_dragging = false;

    let day_offset;

    let start_row = 0;
    let start_time = 0;


    let end_row = 0;

    let colom = 0;

    agenda_wrapper.addEventListener('mousedown', function(event) {

        if (event.target === agenda_wrapper) {
            //mouse is pressed on the agenda
            is_dragging = true;
            start_row = get_row(event)[0] + 4;
            start_time = get_row(event)[1];

            colom = get_colom(event)[0] + 1;

            //remove all the temp agenda items
            let temp_items = document.querySelectorAll('.agenda-item-temp');
            temp_items.forEach(function (item) {
                item.remove();
            });
        }

    });

    agenda_wrapper.addEventListener('mousemove', function(event) {
        if(is_dragging === true){
            //mouse is moving on the agenda and is pressed
            end_row = get_row(event)[0] + 4;

            //remove all the temp agenda items
            let temp_items = document.querySelectorAll('.agenda-item-temp');
            temp_items.forEach(function(item) {
                item.remove();
            });


            let agenda_item_temp = document.createElement('div');
            agenda_item_temp.classList.add('agenda-item-temp');

            agenda_wrapper.appendChild(agenda_item_temp);

            agenda_item_temp.style.gridRowStart = start_row;
            agenda_item_temp.style.gridRowEnd = end_row;

            agenda_item_temp.style.gridColumn = colom;

            agenda_item_temp.style.backgroundColor = '#22007c';
            agenda_item_temp.style.border = '1px solid whites';
        }
    });

    agenda_wrapper.addEventListener('mouseup', function() {
        //mouse is not pressed on the agenda anymore
        is_dragging = false;
    });

    function get_row(event){
        let rect = agenda_wrapper.getBoundingClientRect();
        let y = event.clientY - rect.top;
        let row_height = (agenda_wrapper.clientHeight / row_amount);

        //calucate the time that corresponds to the row (1 row = 15 minutes)
        let time = Math.floor(y / row_height) * 15;
        let hours = Math.floor(time / 60);
        let minutes = time % 60;

        // format the time value so it can be used in the input field
        let formatted_time = hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0');

        console.log(Math.floor(y / row_height));

        return [Math.floor(y / row_height), formatted_time];
    }

    function get_colom(event){
        let rect = agenda_wrapper.getBoundingClientRect();
        let x = event.clientX - rect.left;
        let colom_width = agenda_wrapper.clientWidth / colom_amount;

        //calucate the day ofset that corresponds to the colom
        day_offset = Math.floor(x / colom_width);

        return [Math.floor(x / colom_width), day_offset];
    }
</script>


</body>
</html>